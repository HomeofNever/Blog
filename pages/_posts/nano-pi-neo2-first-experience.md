---
title: Nano Pi NEO2 体验小记
tags: 
    - 项目
    - nanopi
    - arm
    - 折腾
    - 监控
    - zerotier
categories:
    - 坑
layout: post
date: 2019-05-31 11:42:00
---

## 剧情前提

之前给几家店铺做了监控方案的设计，用的是POE供电摄像头配NVR。采用的是大华的方案，但是是自己直接去公司拿货自配帮忙布线，顺便把路由部分也包了。

大华的方案好处是有乐橙云，绑定机器后相当傻瓜，可以直接用APP观看实时或者历史录像。但是机器设置还是要到现场（应该是为了安全）。

然而部分店铺没有配置显示器，而且大华逐渐淘汰了他们的Web界面，转用客户端连接。每次需要调整配置需要到现场链接网络调试，非常的不方便

## 初步想法

当时就想的是做内网穿透，因为都是小店用的都是一般的宽带，公网是没有了。这样子每次只要有问题直接穿透回去看看就好了，还可以顺便监控一下网络质量（☑️

### 选型

内网穿透嘛……国内比较有名的也就是花生壳了，但是花生棒99元还要购买后续服务，宽带也小得可怜，果断pass

其他的一些冷门点的公司又信不过，而且部分店铺是用的相当原始的路由器（主要是TPLINK家用，部分是企业级），虽然说普联自带了一个IPSec，但是部分店铺又没有，租用国内服务器价格也不算便宜（自建SLA===0），于是又pass

同时也发现极路由之类的智能路由似乎带有这种功能，比如Zerotier，但是这种东西定制性...还不如自己加块树莓派上去

等等，树莓派？

#### 价格

还是有点贵啊，淘宝转了一圈3B普遍200+，而且还没有外壳。不过为了测试我自己做内网穿透的机器，我还是先从 @Kookxiang 手里淘了一个二手树莓派，150带金属外壳  

介于之前接触了一下 ripe probe，那个小巧的外形让我觉得...价格应该不算很高吧（毕竟都是免费发），功耗也很低。查了一下名字neo2，淘宝一看基本价格100左右，全志H5性能也不算差，而且**网口是千兆的**，那就试试看吧
 
（其实就是树莓派玩腻了hhh）

[参数/购买参考地址](https://www.friendlyarm.com/index.php?route=product/product&product_id=180&search=neo2&description=true&category_id=0)

##### 小插曲

淘宝店铺最低的是99，当我看上了准备买的时候，发现商家是广州的，一问是不是在岗顶的新赛格，还真的是，于是直接上门买了，省下10块钱邮费，嘻嘻

<!-- <script async src="https://telegram.org/js/telegram-widget.js?6" data-telegram-post="ButNothingHappened/2956" data-width="100%"></script> -->

## 跑！

团队名字叫做友善之臂，感觉这个国内这个翻译有点小硬（ARM => 手臂）

扫了一遍`wiki`默认给了 `Ubuntu 16.04` 的包，那就先试试吧

### 下包

[Wiki Page](http://wiki.friendlyarm.com/wiki/index.php/NanoPi_NEO2)

### 烧卡

16G应该算是底线了，去网上随便淘了几张金士顿的16G，烧上系统差不多8G

一开始想试试看`ArchLinux`的`Alarm`，但是懒得折腾就还是上了官方包

NanoPI的卡槽是有弹簧的，这个比树莓派体验好上不少

我在windows做的就是用的`Win32DiskImager`，一开始觉得还是一个盗版玩意结果不是（

### 开机
<!-- 
<script async src="https://telegram.org/js/telegram-widget.js?6" data-telegram-post="ButNothingHappened/2958" data-width="100%"></script> -->

（见上图）开机直接飙到46度，是有点小难受，早知道就配上散热片了，开久了亚克力板还是有点烫的。因为是监控机要求长时间开着，这个算是有点失策。

用户默认pi@pi，ssh啥的也开好了，测了一下系统默认有个用户`fa`，不知道干啥的于是删掉了。似乎是以前用的名字（friendarm）。镜像没太多检测可能还是有点坑，还要找时间看看咋回事（咕咕咕

#### 装 Zerotier

官方安装脚本地址：https://install.zerotier.com/

没有毛病，按照指令装就好了，略略略

每次需要维护直接ssh转发端口，就可以直接进到内网咯，完美

## 后记

接下来顺便还玩了不少有趣的东西（或者小发现）

### Zerotier

一开始想着`zeortier`国内穿透可能一般般，现在国内大内网肯定要转发，节点的话……看了一下应该都是`AWS`的，但是出乎意料的连通性很好，而且很稳。~~看来这车没翻~~

### SS

后面还是在每台机器上跑了SS，懒得ssh转发端口了（嘻嘻），而且这样子相当于多了个三个国内出口（电信，移动，联通，电视网全都有了），突然有趣

### Torch

想着平时用的也不多，机器空转着也没啥用，就顺便做了[Torch](https://github.com/Torchping)的监测点。

> 简单说一下，这是一个TCPING检测的工具，并对外提供了API，如果节点在国内可以用于检测节点是否被墙。

目前赞助的节点都在机房，我是没这个钱，但是目前既然有这么好的家宽节点，为什么不用呢（

把之前魔方云给的节点接入这个组网里面，然后配置一下`Caddy`反向代理……完美

（然而最近魔方云炸裂了，噗）

### 其他

但是目前开机时间差不多有快一个月，安置机器的时候放的稍微透风一点，似乎没有太多问题。

后续还有更多玩法的话，就在更新好了
一直没用上针脚的功能呢……
