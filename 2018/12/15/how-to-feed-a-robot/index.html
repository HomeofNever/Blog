<!DOCTYPE html><html data-saber-ssr lang="zh-CN" class="serif" data-saber-head="%7B%22lang%22:%7B%22ssr%22:%22zh-CN%22%7D,%22class%22:%7B%22ssr%22:%22serif%22%7D%7D"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="ie=edge" /><meta data-saber-head="ssr" name="generator" content="Saber v0.11.6"><meta data-saber-head="ssr" name="author" content="NeverBehave"><meta data-saber-head="ssr" property="og:type" content="website"><meta data-saber-head="ssr" name="twitter:card" content="summary"><meta data-saber-head="ssr" name="twitter:creator" content="NeverBehave"><meta data-saber-head="ssr" name="description" content="迷の生物的迷の小窝" data-hid="description"><meta data-saber-head="ssr" name="keywords" content="undefined,,"><meta data-saber-head="ssr" property="og:title" content="如何科学的给机器人投食"><meta data-saber-head="ssr" property="og:description" content="迷の生物的迷の小窝"><meta data-saber-head="ssr" name="twitter:title" content="如何科学的给机器人投食"><meta data-saber-head="ssr" name="twitter:description" content="迷の生物的迷の小窝"> <title>如何科学的给机器人投食 - Never迷の小窝</title> <link data-saber-head="ssr" rel="manifest" href="/manifest.json"><link data-saber-head="ssr" rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png"><link data-saber-head="ssr" rel="alternate" title="Never迷の小窝 - Feed" href="https://blog.never.pet/feed/atom.xml" type="application/atom+xml"><link data-saber-head="ssr" href="https://cdn.jsdelivr.net/" rel="preconnect" crossorigin="true"><style data-vue-ssr-id="c371470e:0 4cf09be2:0 72951a42:0">.blendIn_16__k[data-src],.blendIn_16__k[data-srcset]{transition:filter .3s;filter:blur(5px)}.blendIn_16__k[data-lazy-loaded]{filter:none}
blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,ol,p,pre,ul{margin:0;padding:0}body{font:400 16px/1.5 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;color:#111;background-color:#fdfdfd;-webkit-text-size-adjust:100%;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;font-feature-settings:"kern" 1;font-kerning:normal;display:flex;min-height:100vh;flex-direction:column}blockquote,dl,figure,h1,h2,h3,h4,h5,h6,ol,p,pre,ul{margin-bottom:15px}main{display:block}img{max-width:100%;vertical-align:middle}figure>img{display:block}figcaption{font-size:14px}ol,ul{margin-left:30px}li>ol,li>ul{margin-bottom:0}h1,h2,h3,h4,h5,h6{font-weight:400}a{color:#2a7ae2;text-decoration:none}a:visited{color:#1756a9}a:hover{color:#111;text-decoration:underline}.social-media-list a:hover{text-decoration:none}.social-media-list a:hover .username{text-decoration:underline}blockquote{color:#828282;border-left:4px solid #e8e8e8;padding-left:15px;font-size:18px;letter-spacing:-1px;font-style:italic}blockquote>:last-child{margin-bottom:0}code,pre{font-size:15px;border:1px solid #e8e8e8;border-radius:3px;background-color:#eef}code{padding:1px 5px}pre{padding:8px 12px;overflow-x:auto}pre>code{border:0;padding-right:0;padding-left:0}.wrapper{max-width:770px;margin-right:auto;margin-left:auto;padding-right:15px;padding-left:15px}@media screen and (min-width:800px){.wrapper{max-width:740px;padding-right:30px;padding-left:30px}}.footer-col-wrapper:after,.wrapper:after{content:"";display:table;clear:both}.orange{color:#f66a0a}.grey{color:#828282}.svg-icon{width:16px;height:16px;display:inline-block;fill:currentColor;padding:5px 3px 2px 5px;vertical-align:text-bottom}table{margin-bottom:30px;width:100%;text-align:left;color:#3f3f3f;border-collapse:collapse;border:1px solid #e8e8e8}table tr:nth-child(2n){background-color:#f7f7f7}table td,table th{padding:10px 15px}table th{background-color:#f0f0f0;border:1px solid #dedede;border-bottom-color:#c9c9c9}table td{border:1px solid #e8e8e8}.site-header{border-top:5px solid #424242;border-bottom:1px solid #e8e8e8;min-height:55.95px;line-height:54px;position:relative}.site-title{font-size:26px;font-weight:300;letter-spacing:-1px;margin-bottom:0;float:left}@media screen and (max-width:600px){.site-title{padding-right:45px}}.site-title,.site-title:visited{color:#424242}.site-nav{position:absolute;top:9px;right:15px;background-color:#fdfdfd;border:1px solid #e8e8e8;border-radius:5px;text-align:right}.site-nav .nav-trigger{display:none}.site-nav .menu-icon{float:right;width:36px;height:26px;line-height:0;padding-top:10px;text-align:center}.site-nav .menu-icon>svg path{fill:#424242}.site-nav label[for=nav-trigger]{display:block;float:right;width:36px;height:36px;z-index:2;cursor:pointer}.site-nav input~.trigger{clear:both;display:none}.site-nav input:checked~.trigger{display:block;padding-bottom:5px}.site-nav .page-link{color:#111;line-height:1.5;display:block;padding:5px 10px;margin-left:20px}.site-nav .page-link:not(:last-child){margin-right:0}@media screen and (min-width:600px){.site-nav{position:static;float:right;border:none;background-color:inherit}.site-nav .menu-icon,.site-nav label[for=nav-trigger]{display:none}.site-nav input~.trigger{display:block}.site-nav .page-link{display:inline;padding:0;margin-left:auto}.site-nav .page-link:not(:last-child){margin-right:20px}}.pagination{margin-bottom:25px;font-size:.875rem}.pagination .next-link,.pagination .prev-link{border:1px solid #e8e8e8;padding:5px 10px;color:#111}.site-footer{border-top:1px solid #e8e8e8;padding:30px 0}.footer-heading{font-size:18px;margin-bottom:15px}.contact-list,.social-media-list{list-style:none;margin-left:0}.footer-col-wrapper{font-size:15px;color:#828282;margin-left:-15px}.footer-col{width:-webkit-calc(100% - 15px);width:calc(100% - 15px);margin-bottom:15px;padding-left:15px}.footer-col-1,.footer-col-2{width:-webkit-calc(50% - 15px);width:calc(50% - 15px)}.footer-col-3{width:-webkit-calc(100% - 15px);width:calc(100% - 15px)}@media screen and (min-width:800px){.footer-col-1{width:-webkit-calc(35% - 15px);width:calc(35% - 15px)}.footer-col-2{width:-webkit-calc(20% - 15px);width:calc(20% - 15px)}.footer-col-3{width:-webkit-calc(45% - 15px);width:calc(45% - 15px)}}@media screen and (min-width:600px){.footer-col{float:left}}.page-content{padding:30px 0;flex:1 0 auto}.page-heading{font-size:32px}.post-list-heading{font-size:28px}.post-list{margin-left:0;list-style:none}.post-list>li{margin-bottom:30px}.post-meta{font-size:14px;color:#828282}.post-link{display:block;font-size:24px}.post-header{margin-bottom:30px}.post-content h1,.post-title{font-size:42px;letter-spacing:-1px;line-height:1}@media screen and (min-width:800px){.post-content h1,.post-title{font-size:42px}}.post-content{margin-bottom:30px}.post-content h2{font-size:28px}@media screen and (min-width:800px){.post-content h2{font-size:32px}}.post-content h3{font-size:22px}@media screen and (min-width:800px){.post-content h3{font-size:26px}}.post-content h4{font-size:18px}@media screen and (min-width:800px){.post-content h4{font-size:20px}}.social-media-list{display:table;margin:0 auto}.social-media-list li{float:left;margin:0 5px}.social-media-list li:first-of-type{margin-left:0}.social-media-list li:last-of-type{margin-right:0}.social-media-list li a{display:block;padding:7.5px;border:1px solid #e8e8e8}.social-media-list li:hover .svg-icon{fill:currentColor}.one-half{width:-webkit-calc(50% - 15px);width:calc(50% - 15px)}
.saber-highlight{position:relative;overflow:hidden;margin:2rem 0;background:#f5f7fa;border-radius:4px}.saber-highlight:before{content:attr(data-lang);position:absolute;right:10px;top:5px;font-size:.75rem;color:#bdc5d1}.saber-highlight-code,.saber-highlight-mask{line-height:1.5;background-color:transparent!important;text-shadow:none!important;box-shadow:none!important;margin:0!important;padding:1.25rem 1.5rem!important;white-space:pre}.saber-highlight-mask{position:absolute;top:0;bottom:0;left:0;right:0;z-index:1;color:transparent!important;padding-left:0!important;padding-right:0!important}.saber-highlight-code{position:relative;z-index:2;font-size:0!important}.saber-highlight-code code,.saber-highlight-mask{font-size:.875rem}.code-line.highlighted{background:rgba(3,169,244,.121)}.saber-highlight-line-numbers{pointer-events:none;font-size:100%;float:left;letter-spacing:-1px;border-right:1px solid #999;user-select:none;text-align:right;padding-right:.8rem;margin-right:.8rem;counter-reset:linenumber}.saber-highlight-line-numbers>span{counter-increment:linenumber;display:block}.saber-highlight-line-numbers>span:before{content:counter(linenumber);color:#999;display:block}</style>  </head><body><div id="_saber" data-server-rendered="true"><div><header class="site-header"><div class="wrapper"><a href="/" rel="author" class="site-title router-link-active">Never迷の小窝</a> <nav class="site-nav"><input type="checkbox" id="nav-trigger" class="nav-trigger"> <label for="nav-trigger"><span class="menu-icon"><svg viewBox="0 0 18 15" width="18px" height="15px"><path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path></svg></span></label> <div class="trigger"><a href="/" class="page-link router-link-active">Home</a><a href="/about" class="page-link">About</a><a rel="noopener noreferrer" target="_blank" href="https://never.pet" class="page-link">Social</a><a href="/friends" class="page-link">Friends</a></div></nav></div></header> <main aria-label="Content" class="page-content"><div class="wrapper"><article itemscope="itemscope" itemtype="http://schema.org/BlogPosting" class="post h-entry"><header class="post-header"><h1 itemprop="name headline" class="post-title p-name">如何科学的给机器人投食</h1> <div align="left" class="post-meta"><time datetime="Sat Dec 15 2018 12:54:00 GMT+0800 (China Standard Time)" itemprop="datePublished" class="dt-published" style="display:inline-block;">2018-12-15</time> <section class="page-categories"><span><!----> <a href="/blog/category/technology" class="category">技术</a></span></section> <section class="page-block-action"><div class="page-share"></div> <div class="page-tags"><span><!----> <span class="tag">折腾</span></span><span><span>,</span> <span class="tag">爬虫</span></span></div></section></div></header> <div itemprop="articleBody" class="post-content e-content"><blockquote><p>机器人在这里特指爬虫，本文特指一些通过扫默认目录尝试窥探 <code>phpmyadmin</code> 一类管理面板的玩意</p></blockquote> <p>最近翻看访问日志的时候发现 80 端口似乎有些异样：
<img alt="" data-lazy="{}" src="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/f9d6840ba73f7e852585e8e2affb61f4-968.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAZCAYAAABD2GxlAAADyElEQVR4AcXBzXYbxxGA0a+7qnuGGAACBdBSmK2ysFdZ5Q3yBnnqPITjk4UtSwxJAcRgfrqrQiyU4+MTLwHdG/q+d149PDygqnRdh4jy8PAZEWEcJ959t2PRLfkWNKWEmXO320EI5JwptbLdbnGHWispN0zTRM6Za1MzY5oLdRrxEMg542YMw4CIUEpFNWLm5Jy5NnV3cGOYRt69e89ZNePU94gowzQh8m8CPxLjP7g25VV1J2nil48fudttcXdEBE0JqZWcPrDo/oqZcW36iqUqtWlYhUCMQtsI8e1baq0suwXtzQ3uTggBd+erEAKXptM0MU4z8zggqmw2G4Zx4OnxkaSJYZxYrzpKKUQRUm7AKvvDnvv7P3NpGmMkxECMgWrG8XhEVHEzaq1Uq4QYuL29RVPiq/WbN1yDhhC4aRpGQERo25ZpnumWS2IUUk40uWd/+Cebzd+5thhC4CzGyFcSIyJCjIGcMxBIyfgW1MyYSwGrdKs1Z8M4sv/yBRFlmCbudm8Zx7/R959ompZh6Hn//p5rUDMDh+f9nnGamYaRtlvg7pg7bkaZC3MpBDcg4B749OuvBFGyCiFGTqcT7o6qEkXIKeHuHI4vdO0N0zSRcubl5chq2THPhdRkghvPz3u6Zcdy2ZFS5re0aRrO2rYhxshZNaPJGXcnxkhKiRUQAAO6boGbEWKEEIgh0HUdIQR+r+s6fmu9XvN7y9WaP6LTNCEi9H3ParXirJbC4XBANZFywt3pTyfKNBFixB1UBTOj1sp2u0VVuQQNIRBC5HTqcTc2m1vMnWkcqaXiOLroqGUmSkREMOOVo0nJOZNz5lK0lIKmRNveICKYGUkTb3d31Fqo1UgqbLc7Yoz8P2bGpWjbtlitNE2DqnImEkkoEiMhg4jwreg8z4gIT09PbDYbVJX+dOI/nx8QFXLT0C0WvLy8cHd3x7VpCIHTMJBSYrFYcBYIEHgVOOwPJBGaJvP89ER/Gsg5sV6taNqWS9MYIzdtS04JM+NMVdhsNkDg5qalaRtEBNXEmw3/Y2ZcWuRVKTO1Vr5yoMwFs4o7rwJlLnwLamaUarzs9xyPR7bbLbVWjscXRJRhmpAY6IeR3B9Zrta0bcu1qLsjUQghsNvtOHNzCIEoQgyBlBWdC+bOPM88Pj6y6BacTiea3JBU6ZZLLkFzzpyltOPsXz/9xKfPD5RSGMeREODnj7/g7txuNvzlwwe6rmOeZ9arNZem8zxj5jw/PfKn+3uev3xhGEcO+z1RhHmeOfY9qsrx2PPD999z1jQN1/BftWXK6qb6ZkwAAAAASUVORK5CYII=" data-srcset="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/f9d6840ba73f7e852585e8e2affb61f4-968.png 968w,https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/31c8ab5f16c29aa42338946a5f2ff64c-720.png 720w,https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/315390605e2e8d2cd94a9698fd3006cc-480.png 480w" width="968"></p> <p>都是什么狗屁.jpg</p> <p>因为自己平时也不用 80 走服务，主要都是 301 到 https，那么……为什么不给他们点好玩的呢？</p> <h2 id="动手时间">动手时间</h2> <blockquote><p>参考仓库：<a rel="noopener noreferrer" target="_blank" href="https://github.com/NeverBehave/BotBomb">https://github.com/NeverBehave/BotBomb</a>
首页：<a rel="noopener noreferrer" target="_blank" href="https://shit.xn--i2r989d.xn--6qq986b3xl/">https://shit.猫喵.我爱你/</a></p></blockquote> <p>思路很简单：直接在跳转之前判断一下，如果 <code>user-agent</code> 或者 <code>URL</code> 包含关键词直接返回构造好的请求</p> <p>目前我的规则比较暴力，但是也比较有效，就是所有<code>.php|.cgi|.jsp|.aspx</code> 之类的直接弹，因为我不会用 <code>Plain Text</code> 暴露服务</p> <p>至于说规则怎么加，一开始我是想着用 <code>nginx</code> 的规则直接加，但是管理起来确实不方便：<a rel="noopener noreferrer" target="_blank" href="https://github.com/NeverBehave/docker-nginx-https-redirect/">仓库</a> 。所以我找到了以前一个还不错的项目 <a rel="noopener noreferrer" target="_blank" href="https://github.com/NeverBehave/VeryNginx">VeryNginx</a></p> <blockquote><p>因为原作者不再更新，这里我放上我的 Fork，可以很方便的配合 Docker 食用</p></blockquote> <figure><img alt="" data-lazy="{}" src="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/68b7392d7dc10ddf85284a4dd730525e-1200.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAGCAYAAACxWNwrAAABYElEQVR4AZXB624TMRSF0W/7jD25NLQF3v8RkYDmMo19Np0fIyGBEFlLfQznGFwuF8YYSMJODocj8zyzss2yLGQmEUGRMCsDYmWblSRaazyij8HPyzv7FhixnyubqUiUaeJ4PGIb26wiAklszucLdhIRLMtCppGg1sr9fkcIBKenJ+Z55hFRCsd9IyQMSGJlm6n3jjN5O5/pvaMSRIHX18/YZmWbeTfjMYhaaa2xkkRmst/vWWUmrTVs84iRyfe3G8ddxTZTFDbTByTx2hob20jid713cNJvgxwD88HGNkjYJiKotdIkHhGl8OXTAQQYJLGyzTTGYIzB+Xym944kpjrx8vzCxjZRCstyp5TCvNsxxkASYwxKKWxutxvX65WIYHU6nZDEv4xMvv24ctxV0nA6zGymUgoRQa2VjW3+JDKT5f2duTVW9/udiCAzsU0pBdtIovdOkfgfReLr84G/+QX3o78/prX+rwAAAABJRU5ErkJggg==" data-srcset="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/68b7392d7dc10ddf85284a4dd730525e-1200.png 1200w,https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/24b5b9e6904aad915c59b3a358ffa255-720.png 720w,https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/40d3a7d6cbe99bb9653a7f932a2b83a6-480.png 480w" width="1200"></figure> <p>配合目前的集群，所以大致关系如下：</p> <div class="saber-highlight" data-lang=""><pre class="saber-highlight-code language-text"><code class="language-text">+---------------+      +---------------+    +----------------+
Expose  |    LB-Exit    +------&gt;   VeryNginx   +----&gt;   Redirector   |
 Port   |    Cluster    |      |               |    |                |
  80    |               &lt;------+               &lt;----+                |
        +---------------+      +---------------+    +----------------+</code></pre></div><h3 id="qampa">Q&amp;A</h3> <ol><li>为什么要加上一个<code>Redirector</code>?
因为 <code>VeryNginx</code> 本身的限制，他的过滤顺序是：<code>Rewrite</code>，<code>Access</code>（这个限制是<code>Nginx</code>给<code>Lua</code>的，因为是在<code>Nginx</code>的请求周期内插入<code>Lua</code>。也就是如果你用<code>Schema Lock</code>的话，他会先把所有请求转换成 <code>https</code> 后进行继续的过滤，导致我的规则全部失效。所以我需要先<code>filter</code>请求再执行处理的话，就必须再开一个<code>backend</code>执行自己需要的操作。我现在的操作是如果符合<code>filter</code>就弹回<code>200</code>或者<code>302</code>状态码（后续解释原因）。否则<code>301</code>转向<code>https</code>后续如果继续维护<code>VeryNginx</code>我会继续去看看这里怎么处理。不过我觉得现在这个做法确实是最好的：如果自定义动作都能实现，那不就是直接写<code>API</code>的操作嘛（……</li></ol> <h2 id="探索与发现">探索与发现</h2> <h3 id="爬虫到底吃什么">爬虫到底吃什么</h3> <p>一般来说，有两种做法：</p> <ul><li>丢个很大的文件（1tb.bin）</li> <li>丢个<code>Gzip</code>炸弹（booooom）</li> <li>举报一下（懒）</li></ul> <p>首先我们观察一下情况：</p> <figure><img alt="" data-lazy="{}" src="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/d1694492012cefa9f68f053b7d1bf009-1200.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAASCAYAAAApH5ymAAADg0lEQVR4AaXBa24UVxSF0W+fe6vcL8smxDNKBsAoGA9jiZTfzAcjJJtud9V97KSISuqgTghkLZ1OL57nie32wPl8YrfbkPPA/1Vr5Xg8Mg4Dwzjy9PREKYXdbsd2u2WeZ15eXqi1Mo4jd3d3tNZ4fn4mIogIDocDudbCMAz8/vtvvHv3jtXbt2/55ddfCYmUEr13Lklis9kgiWtsM44jEUGtFUnc39+zqLUyTRPDMHA4HFiUUpjnQmuNlBKSmOeZPI4jkvjw4QPv379n9ebNG7abDSGhCFprrGwjiZubERDX2GYhCdtEBMMwsLBNRLAYhoFVSplhyEQEvXfGcSTXWhmGga+VuXA+n+nd7Pdbdrsd36v3TkqJxel04u7ujtXpeCLlxDAMrGotPD8/s91uiQgWWRKSkMQlRSDBw8PP/ChJSGIhQBIrCSQhiZUkJPGFjSSybWxjm0u9N2ptPD4+knOizJWUg9Y6ixTB/f09iuAa29jGNrYxYJuFbWywjW1WtrHNFxK2ySklrtnv97x+/ZqI4BrbSOLfRASr3W7Hpd1+R0RwKaXM7e0tEYEkFtF755rz+czz0xP/RBLfYptVmQuXyjxTSuHvzDzPtN6otbLItpGEJC713qmt8enTJ25vDwzDyPeyjSQWtRYksaq1kgBJrHrvzPNMRBASksiSsI1tviaJlBI5D9jme9jGNraxjQHbLGxjg21ss7KNbQwYsE3Y5pqcM0MeiAhaq/wISaxySlxKOZFz5pIkcs6kCFJKLPKfuCbnzM3mhr+IHxERrG42Gy5tNhskcSnnzH6/RxK9dxZRSuGaaZqYp4lxHEkp8SNaa6yOxyOXjp+PvLy8cKmUytPTE/M801pjkd07kpDEpd47cyl8/PiRRUTQW8NASsFPP73mWyQhiYUASawkkIQkVhJf2EaAJLIisI1tLkliHEcOhwPX2Obf2MY2trGNAdssbGODbWyzso1tvpCwTZ6midYa8zxzKefM4vPnzywkMY4j/5VtbNN7xzYpJUopLGyTciIiKKWw6r0zDAOSiAhKKWT3jm1sc6nWyjRNpJTorWEg54wk/gvbLGxjG/eObRa2ce90wDZfs00thWEcyYpgGAYOhwMPDw+sUkqczy+klMgpU1vj4+MjkRIRwatXr/iW3jsRweI8TWy2W1bnaSLnzM3NDavWGqfjke1uR0SQbf4AgLkEYt9cWMYAAAAASUVORK5CYII=" data-srcset="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/d1694492012cefa9f68f053b7d1bf009-1200.png 1200w,https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/e9a05f9dbefbcb004ee231afc9b01a87-720.png 720w,https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/4085b816abb37c4ee38de78d08bec39f-480.png 480w" width="1200"></figure> <p>结合之前从集群日志爬出来的结果来看，可以了解到几点：</p> <ul><li>有用<code>Python</code>写的，估计很粗糙（<code>useragent</code>）</li> <li>他们是有一个扫的目录的列表（emmmm，整理一份放进仓库好了</li></ul> <p>介于此，有几个猜测：</p> <ul><li><p>他们会跟随<code>302</code>到另外一个地方去答案似乎是对，我的<code>1tb.bin</code>每次都会在机器人来的时候被爬掉<code>5GB</code>左右的流量
<img alt="" data-lazy="{}" src="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/fc0becd22ebdb4d11a79fd4588b530de-1200.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAAWCAYAAACyjt6wAAAEIElEQVR4AcXBQW4jxwGF4f9VVzfVFDUSpQmEeDCSs7IXWfssPkFyHG99EB8kySabLGJgAgRji6JFkWx2d9WLywEBRiHHGSSBv0/ffGN/9RVsNiDBYgF1DTZ8+SX87vff8/z8TPHmk09omob/t+XyB4ZxYNq2xC++2PH11yCBJJqmZhzhu+9gcj5ydv6Ky6s5dRUobLPXDYndkChmZzVVEIfGbLp+pAqBlDOTuqKuAi/1Y2JImbaJBInLy1eklEgpEcdxwfk5P5HE7e0txf09P4ocI4mibSJtE3kp54wkYhDnZzWiqNizjST2mljRxIpDm82G9XpN5AVJ2KawjSQk8TFCCOyJfyeJnyOJInLEH/74J5o64pyZXVxwf3/PLyVyxG8+vafbbkEi58z79++5vb3lJds8PT2x3W6xjRApJ+bzOdPplEO2eVwsSNnkPJINNqSh5+3dHadEjgihom4aDEzblqoKnJKzqeuaom1bislkwjGhimQP1HVD27bY/Mh8SOCIUAWQCCHwuPwBKXCKgWEcGVJi1/d03Y6qqjimihEpUNcNi8cldR2ZTqd8SOSIOtbUdU2QmEwmxBg5ZXZ+Tp62OJsqVmBOaurIpKmJMRJCIMbIz4kcEWPFOA7EekKMkcI2x9R15CXbHNM0DXvTactf/r5kXifa2RW7zRMI5ldzDkWO2G63/O3dO97e3dG2Lf8ruyHTDZnLaaR4e/OKSR0oppM5hSQOBY6YzWZ89vnnFJIoJCEJSRSSkIQk/klIQhKFJCQhiUISD88Df363ZkxGEo/rkUISkpDES4ETFosFtrFNYRvb2KawjW1sUzysemxjm8I2trFNYZvNLlGsdwnbPKx6CtvYxjYvBY54fFzysb5fDWTzQdtdptjsEgaeu8QwZj4kcERKI9fX10hCEoUkJCGJQhKSkESx7hKbXUIShSQkIYmfSGz7TLHtM/1gbNgOGUlIQhJdnzkUOOLq6orFYoFtbFPYxja2KWxjG9v0Y6YfM+suYZvCNraxTdH1iWxTbHaJTZ8otruEbWxjm4dVz6HAETFGQhD/qXWXKNa7xCnbXWJvs0tsd4li22f2hmRWXeJQ4ISrqzmSkEQxJsgGSRSSkIQk1rtEse4SkigksXge6YZMse0ze9mwXI8U2z4jCUksngcw/yJywrff/pXJ5Iy2bXl4WFBNpjR1w1ktHh8fmM+vCSEwjiNheOK3dzcI6LqOvu+Znl/QRPH8vGGImZuLGa+mkfV6jXNmdnFGsVqtWK/XNJOW2aRit17yvMrsRU64v/+Uvdevbzj0+vWv2Kvrmje/vmVvTNB1HU/LBdc3N1y0F+ydARftJYcu2jl7dQzM3txSrFYrisgLtvlvVKHi8vKSwjYfK2UTBLYpIi8Mw8AvabnZkZJpq0zxD/1ZD1UocXvsAAAAAElFTkSuQmCC" data-srcset="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/fc0becd22ebdb4d11a79fd4588b530de-1200.png 1200w,https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/8f075ad64b2f32aa6bc69e2bc9d2aeae-720.png 720w,https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/6a1ec374f55e6526600fb28bdacddbca-480.png 480w" width="1200"></p></li> <li><p>他们更喜欢<code>200</code>目前的话……没有太多结论。至少我尝试过如下：</p> <ul><li>直接弹<code>gzip</code>炸弹他们会爬完，但是似乎并没有什么效果，而且……流量消耗不少XD
后面看了一下似乎默认的库不会处理<code>gzip</code>，要自己处理？</li> <li>弹个<code>200</code>回去例子：<a rel="noopener noreferrer" target="_blank" href="https://docker.shit.xn--i2r989d.xn--6qq986b3xl/">https://docker.shit.猫喵.我爱你/</a>
这个思想是因为默认，爬虫会解析<code>&lt;a&gt;</code>标签并跟随，那么，我做个假的不就好了？结果是<strong>并没有什么卵用</strong>，反正看起来没人中招</li></ul></li></ul> <h3 id="小发现">小发现</h3> <p>虽然说<code>200</code>状态码 + 正常网页惨败，由此却给我带来了一个小想法：如果我在<code>&lt;script src=&quot;&quot;&gt;</code>这里写上一个<code>1tb.bin</code>，浏览器会怎么处理？</p> <p>结果有点意思：浏览器会忽略<code>content-type</code>和<code>content-length</code>，疯狂的下载这个文件，而且没有任何提示。</p> <p>你可以在这里测试一下：<a rel="noopener noreferrer" target="_blank" href="https://docker.shit.xn--i2r989d.xn--6qq986b3xl/malformed.html">malformed.html</a>
记得打开<code>Network Tab</code>观察</p> <figure><img alt="" data-lazy="{}" src="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/3ee7a5dc5b4a172a2e67bc3661c99b34-1001.png" srcset="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACgAAAADCAYAAADhlU2YAAAA+UlEQVR4AW3BO67aUBiF0W/vY/wQko2hoKGKlNllTplQ5oHSIECXGxs4/sMp6FhL8XI+n3mrqoqUEsuyIIki54xtUkqklHiLCCRRPJ9P5nmm6zpyztjGNpJYloX7/c7j8aDrOgpJpJT4JCKQRFHx8pi+mP99kd0REfR9j22KeZ6p6xpJFMfjkf1+T3G9Xsk5M44jp9OJy+VC0zTYpq5rxnFEEtM0MU0Tt9uNvu+pqorff7/5c9ryUQRIFBUv7XqgXQ8UtokIJCGJ1WpFYRvbHA4H3rbbLZIodrsdm82Gpml4iwgkYZu2bRmGAdsUv36sST8TnyzLgm2K/8qCW6i1G798AAAAAElFTkSuQmCC" data-srcset="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/3ee7a5dc5b4a172a2e67bc3661c99b34-1001.png 1001w,https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/a8d81df97c272adc7d369b60a342c471-720.png 720w,https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/f69453f433c1d128c44bb5225ac7ed82-480.png 480w" width="1001"></figure> <p>虽然图里面只有<code>40M</code>，那是因为我手动停止了。实际测试是不会停止的。而且，是默默的在后台载入。不知道这是一个<code>Bug</code>还是一个<code>Feature</code>。暂时没有测试除了<code>Chrome</code>以外的表现，但是<code>Android</code>上和<code>PC</code>的<code>Chrome</code>表现一致。</p> <h2 id="结论">结论</h2> <p>还是丢<code>302</code>让他们跟随吧，如果能伪装一下<code>content-type</code>和<code>content-length</code>就做一下，不行就算了。目前来看最有效最科学的方法就是这样。</p></div> <div id="disqus_thread"></div> <a href="/2018/12/15/how-to-feed-a-robot" hidden="hidden" class="u-url router-link-exact-active router-link-active"></a></article></div></main> <footer class="site-footer h-card"><div class="wrapper"><div class="footer-col-wrapper"><div class="footer-col one-half"><h2 class="footer-heading">Never迷の小窝</h2> <ul class="contact-list"><li class="p-name">NeverBehave</li> <li><a href="mailto:i@never.pet" class="u-email">i@never.pet</a></li></ul></div> <div class="footer-col one-half"><p>迷の生物的迷の小窝</p></div> <div class="social-links"></div></div></div></footer></div></div><script src="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/js/client.bae157f1.js" defer></script><script src="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/js/page--_posts-how-to-feed-a-robot-md.357ce782.js" defer></script></body></html>
