<!DOCTYPE html><html data-saber-ssr lang="zh-CN" class="serif" data-saber-head="%7B%22lang%22:%7B%22ssr%22:%22zh-CN%22%7D,%22class%22:%7B%22ssr%22:%22serif%22%7D%7D"><head><meta charset="UTF-8" /><meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta http-equiv="X-UA-Compatible" content="ie=edge" /><meta data-saber-head="ssr" name="generator" content="Saber v0.11.6"><meta data-saber-head="ssr" name="author" content="NeverBehave"><meta data-saber-head="ssr" property="og:type" content="website"><meta data-saber-head="ssr" property="og:image" content="https://blog.never.pet/icons/android-chrome-512x512.png"><meta data-saber-head="ssr" name="twitter:card" content="summary"><meta data-saber-head="ssr" name="twitter:site" content="_NeverBehave_"><meta data-saber-head="ssr" name="twitter:image" content="https://blog.never.pet/icons/android-chrome-512x512.png"><meta data-saber-head="ssr" name="twitter:creator" content="NeverBehave"><meta data-saber-head="ssr" name="description" content="迷の生物的迷の小窝" data-hid="description"><meta data-saber-head="ssr" name="keywords" content="undefined,,,"><meta data-saber-head="ssr" property="og:title" content="给 LSI 9266-8i 刷 IT Mode"><meta data-saber-head="ssr" property="og:description" content="迷の生物的迷の小窝"><meta data-saber-head="ssr" name="twitter:title" content="给 LSI 9266-8i 刷 IT Mode"><meta data-saber-head="ssr" name="twitter:description" content="迷の生物的迷の小窝"> <title>给 LSI 9266-8i 刷 IT Mode - Never迷の小窝</title> <link data-saber-head="ssr" rel="manifest" href="/manifest.json"><link data-saber-head="ssr" rel="apple-touch-icon" sizes="180x180" href="/icons/apple-icon-180x180.png"><link data-saber-head="ssr" rel="alternate" title="Never迷の小窝 - Feed" href="https://blog.never.pet/feed/atom.xml" type="application/atom+xml"><link data-saber-head="ssr" href="https://cdn.jsdelivr.net/" rel="preconnect" crossorigin="true"><style data-vue-ssr-id="44ad3bfa:0 c371470e:0 4cf09be2:0 72951a42:0 6a678705:0">code[class*=language-],pre[class*=language-]{color:#000;background:none;text-shadow:0 1px #fff;font-family:Consolas,Monaco,Andale Mono,Ubuntu Mono,monospace;font-size:1em;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;word-wrap:normal;line-height:1.5;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none}code[class*=language-]::-moz-selection,code[class*=language-] ::-moz-selection,pre[class*=language-]::-moz-selection,pre[class*=language-] ::-moz-selection{text-shadow:none;background:#b3d4fc}code[class*=language-]::selection,code[class*=language-] ::selection,pre[class*=language-]::selection,pre[class*=language-] ::selection{text-shadow:none;background:#b3d4fc}@media print{code[class*=language-],pre[class*=language-]{text-shadow:none}}pre[class*=language-]{padding:1em;margin:.5em 0;overflow:auto}:not(pre)>code[class*=language-],pre[class*=language-]{background:#f5f2f0}:not(pre)>code[class*=language-]{padding:.1em;border-radius:.3em;white-space:normal}.token.cdata,.token.comment,.token.doctype,.token.prolog{color:#708090}.token.punctuation{color:#999}.token.namespace{opacity:.7}.token.boolean,.token.constant,.token.deleted,.token.number,.token.property,.token.symbol,.token.tag{color:#905}.token.attr-name,.token.builtin,.token.char,.token.inserted,.token.selector,.token.string{color:#690}.language-css .token.string,.style .token.string,.token.entity,.token.operator,.token.url{color:#9a6e3a;background:hsla(0,0%,100%,.5)}.token.atrule,.token.attr-value,.token.keyword{color:#07a}.token.class-name,.token.function{color:#dd4a68}.token.important,.token.regex,.token.variable{color:#e90}.token.bold,.token.important{font-weight:700}.token.italic{font-style:italic}.token.entity{cursor:help}
.blendIn_16__k[data-src],.blendIn_16__k[data-srcset]{transition:filter .3s;filter:blur(5px)}.blendIn_16__k[data-lazy-loaded]{filter:none}
blockquote,body,dd,dl,figure,h1,h2,h3,h4,h5,h6,hr,ol,p,pre,ul{margin:0;padding:0}body{font:400 16px/1.5 -apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica,Arial,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol;color:#111;background-color:#fdfdfd;-webkit-text-size-adjust:100%;-webkit-font-feature-settings:"kern" 1;-moz-font-feature-settings:"kern" 1;-o-font-feature-settings:"kern" 1;font-feature-settings:"kern" 1;font-kerning:normal;display:flex;min-height:100vh;flex-direction:column}blockquote,dl,figure,h1,h2,h3,h4,h5,h6,ol,p,pre,ul{margin-bottom:15px}main{display:block}img{max-width:100%;vertical-align:middle}figure>img{display:block}figcaption{font-size:14px}ol,ul{margin-left:30px}li>ol,li>ul{margin-bottom:0}h1,h2,h3,h4,h5,h6{font-weight:700}a{color:#2a7ae2;text-decoration:none}a:visited{color:#1756a9}a:hover{color:#111;text-decoration:underline}.social-media-list a:hover{text-decoration:none}.social-media-list a:hover .username{text-decoration:underline}blockquote{color:#828282;border-left:4px solid #e8e8e8;padding-left:15px;font-size:18px;letter-spacing:-1px;font-style:italic}blockquote>:last-child{margin-bottom:0}code,pre{font-size:15px;border:1px solid #e8e8e8;border-radius:3px;background-color:#eef}code{padding:1px 5px}pre{padding:8px 12px;overflow-x:auto}pre>code{border:0;padding-right:0;padding-left:0}.wrapper{max-width:770px;margin-right:auto;margin-left:auto;padding-right:15px;padding-left:15px}@media screen and (min-width:800px){.wrapper{max-width:740px;padding-right:30px;padding-left:30px}}.footer-col-wrapper:after,.wrapper:after{content:"";display:table;clear:both}.orange{color:#f66a0a}.grey{color:#828282}.svg-icon{width:16px;height:16px;display:inline-block;fill:currentColor;padding:5px 3px 2px 5px;vertical-align:text-bottom}table{margin-bottom:30px;width:100%;text-align:left;color:#3f3f3f;border-collapse:collapse;border:1px solid #e8e8e8}table tr:nth-child(2n){background-color:#f7f7f7}table td,table th{padding:10px 15px}table th{background-color:#f0f0f0;border:1px solid #dedede;border-bottom-color:#c9c9c9}table td{border:1px solid #e8e8e8}.site-header{border-top:5px solid #424242;border-bottom:1px solid #e8e8e8;min-height:55.95px;line-height:54px;position:relative}.site-title{font-size:26px;font-weight:300;letter-spacing:-1px;margin-bottom:0;float:left}@media screen and (max-width:600px){.site-title{padding-right:45px}}.site-title,.site-title:visited{color:#424242}.site-nav{position:absolute;top:9px;right:15px;background-color:#fdfdfd;border:1px solid #e8e8e8;border-radius:5px;text-align:right}.site-nav .nav-trigger{display:none}.site-nav .menu-icon{float:right;width:36px;height:26px;line-height:0;padding-top:10px;text-align:center}.site-nav .menu-icon>svg path{fill:#424242}.site-nav label[for=nav-trigger]{display:block;float:right;width:36px;height:36px;z-index:2;cursor:pointer}.site-nav input~.trigger{clear:both;display:none}.site-nav input:checked~.trigger{display:block;padding-bottom:5px}.site-nav .page-link{color:#111;line-height:1.5;display:block;padding:5px 10px;margin-left:20px}.site-nav .page-link:not(:last-child){margin-right:0}@media screen and (min-width:600px){.site-nav{position:static;float:right;border:none;background-color:inherit}.site-nav .menu-icon,.site-nav label[for=nav-trigger]{display:none}.site-nav input~.trigger{display:block}.site-nav .page-link{display:inline;padding:0;margin-left:auto}.site-nav .page-link:not(:last-child){margin-right:20px}}.pagination{margin-bottom:25px;font-size:.875rem}.pagination .next-link,.pagination .prev-link{border:1px solid #e8e8e8;padding:5px 10px;color:#111}.site-footer{border-top:1px solid #e8e8e8;padding:30px 0}.footer-heading{font-size:18px;margin-bottom:15px}.contact-list,.social-media-list{list-style:none;margin-left:0}.footer-col-wrapper{font-size:15px;color:#828282;margin-left:-15px}.footer-col{width:-webkit-calc(100% - 15px);width:calc(100% - 15px);margin-bottom:15px;padding-left:15px}.footer-col-1,.footer-col-2{width:-webkit-calc(50% - 15px);width:calc(50% - 15px)}.footer-col-3{width:-webkit-calc(100% - 15px);width:calc(100% - 15px)}@media screen and (min-width:800px){.footer-col-1{width:-webkit-calc(35% - 15px);width:calc(35% - 15px)}.footer-col-2{width:-webkit-calc(20% - 15px);width:calc(20% - 15px)}.footer-col-3{width:-webkit-calc(45% - 15px);width:calc(45% - 15px)}}@media screen and (min-width:600px){.footer-col{float:left}}.page-content{padding:30px 0;flex:1 0 auto}.page-heading{font-size:32px}.post-list-heading{font-size:28px}.post-list{margin-left:0;list-style:none}.post-list>li{margin-bottom:30px}.post-meta{font-size:14px;color:#828282}.post-link{display:block;font-size:24px}.post-header{margin-bottom:30px}.post-content h1,.post-title{font-size:42px;letter-spacing:-1px;line-height:1}@media screen and (min-width:800px){.post-content h1,.post-title{font-size:42px}}.post-content{margin-bottom:30px}.post-content h2{font-size:28px}@media screen and (min-width:800px){.post-content h2{font-size:32px}}.post-content h3{font-size:22px}@media screen and (min-width:800px){.post-content h3{font-size:26px}}.post-content h4{font-size:18px}@media screen and (min-width:800px){.post-content h4{font-size:20px}}.social-media-list{display:table;margin:0 auto}.social-media-list li{float:left;margin:0 5px}.social-media-list li:first-of-type{margin-left:0}.social-media-list li:last-of-type{margin-right:0}.social-media-list li a{display:block;padding:7.5px;border:1px solid #e8e8e8}.social-media-list li:hover .svg-icon{fill:currentColor}.one-half{width:-webkit-calc(50% - 15px);width:calc(50% - 15px)}
.saber-highlight{position:relative;overflow:hidden;margin:2rem 0;background:#f5f7fa;border-radius:4px}.saber-highlight:before{content:attr(data-lang);position:absolute;right:10px;top:5px;font-size:.75rem;color:#bdc5d1}.saber-highlight-code,.saber-highlight-mask{line-height:1.5;background-color:transparent!important;text-shadow:none!important;box-shadow:none!important;margin:0!important;padding:1.25rem 1.5rem!important;white-space:pre}.saber-highlight-mask{position:absolute;top:0;bottom:0;left:0;right:0;z-index:1;color:transparent!important;padding-left:0!important;padding-right:0!important}.saber-highlight-code{position:relative;z-index:2;font-size:0!important}.saber-highlight-code code,.saber-highlight-mask{font-size:.875rem}.code-line.highlighted{background:rgba(3,169,244,.121)}.saber-highlight-line-numbers{pointer-events:none;font-size:100%;float:left;letter-spacing:-1px;border-right:1px solid #999;user-select:none;text-align:right;padding-right:.8rem;margin-right:.8rem}.saber-highlight-line-numbers>span{counter-increment:linenumber;display:block}.saber-highlight-line-numbers>span:before{content:counter(linenumber);color:#999;display:block}
.post-end[data-v-68f7aa60]{position:relative;margin:3rem 0;color:#ddd;border-bottom:.2em dashed #ddd}</style>  </head><body><div id="_saber" data-server-rendered="true"><div data-v-68f7aa60><header class="site-header"><div class="wrapper"><a href="/" rel="author" class="site-title router-link-active">Never迷の小窝</a> <nav class="site-nav"><input type="checkbox" id="nav-trigger" class="nav-trigger"> <label for="nav-trigger"><span class="menu-icon"><svg viewBox="0 0 18 15" width="18px" height="15px"><path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path></svg></span></label> <div class="trigger"><a href="/" class="page-link router-link-active">Home</a><a href="/about" class="page-link">About</a><a rel="noopener noreferrer" target="_blank" href="https://never.pet" class="page-link">Social</a><a href="/friends" class="page-link">Friends</a></div></nav></div></header> <main aria-label="Content" class="page-content"><div class="wrapper"><article itemscope="itemscope" itemtype="http://schema.org/BlogPosting" class="post h-entry" data-v-68f7aa60><header class="post-header" data-v-68f7aa60><h1 itemprop="name headline" class="post-title p-name" data-v-68f7aa60>给 LSI 9266-8i 刷 IT Mode</h1> <div align="left" class="post-meta" data-v-68f7aa60><time datetime="Wed Jun 22 2022 08:00:00 GMT+0800 (China Standard Time)" itemprop="datePublished" class="dt-published" style="display:inline-block;" data-v-68f7aa60>06/22/2022</time> <section class="page-categories" data-v-68f7aa60><span data-v-68f7aa60><!----> <a href="/blog/category/technology" class="category" data-v-68f7aa60>技术</a></span></section> <section class="page-block-action" data-v-68f7aa60><div class="page-share" data-v-68f7aa60></div> <div class="page-tags" data-v-68f7aa60><span data-v-68f7aa60><!----> <span class="tag" data-v-68f7aa60>折腾</span></span><span data-v-68f7aa60><span data-v-68f7aa60>,</span> <span class="tag" data-v-68f7aa60>HBA</span></span><span data-v-68f7aa60><span data-v-68f7aa60>,</span> <span class="tag" data-v-68f7aa60>Server</span></span></div></section></div> <div data-v-68f7aa60><p><span>书写于 14 天前</span> <!----></p> <!----></div></header> <div itemprop="articleBody" class="post-content e-content" data-v-68f7aa60><h2 id="前提的前提">前提的前提</h2> <p>这个故事的经历以失败暂告一段落，但是着里面的过程我觉得还是值得记录一下。估计以后也用得上 --- ZFS还是一定要IT Mode，没办法。如果你想尝试一下的话不妨接着往下看，我稍微把工具都整理了一下</p> <h2 id="事故前提">事故前提</h2> <p>18年的时候有我和另外一个朋友合组了一台HP 380P G8，这是一台相当老的服务器。21年左右的时候尝试升级了一下，结果后续内存和硬盘各种爆炸，所以想着晚些时候直接换个新的上去好了。结果新的服务器到了以后，文件系统我们换成了ZFS，不再是和以前一样的硬件RAID。ZFS需要直通模式，他既是文件系统，本身也包含了卷管理的功能。大部分RAID卡虽然提供了类似的模式，比如说给你每个盘开RAID 0，或者是提供了一个HBA Mode，但这些模式通常都是由软件模拟的，除了性能可能存在问题，有些甚至无法读取<code>smartctl</code>。所以一般来说会找那种可以刷成直通模式，让卡本身不做任何处理的固件。但是……</p> <p>这次我给搞忘了！反应过来的时候旧机器都已经寄到家门口了……新机器内置的RAID卡<code>P440ar</code>虽然是有HBA模式，看着性能也没啥问题，但是这机器发出去就很难再调整硬件配置，为了保险起见，还是单独弄一张带<code>IT Mode</code>固件的卡好了。</p> <h2 id="理论可行">理论可行</h2> <p>翻箱倒柜找到了一张旧机器里面的<code>9266-8i</code>，搜索了一下，似乎并没有特别多的资料。但是似乎有人留下了一篇<code>cross-flashing</code>的经历：</p> <blockquote><p><a rel="noopener noreferrer" target="_blank" href="https://mywiredhouse.net/blog/flashing-lsi-2208-firmware-use-hba/">https://mywiredhouse.net/blog/flashing-lsi-2208-firmware-use-hba/</a></p></blockquote> <p>大概意思就是Supermicro主板内置刚好也有一块LSI的RAID卡，控制器是<code>SMB2208</code>。这个版本刚好是没有<code>IT Mode</code>的。但是<code>SMB2308</code>有。然而，2208和2308虽然型号不一样，背后的架构其实是差不多的，甚至芯片都是用的一样的……那么，有没有可能可以直接想办法把2308给的固件刷到2208里面呢？</p> <p>答案是可以，作者发现这是真的能用。那么采用2208控制器卡有很多变种，比如我手里这块<code>9266-8i</code>其实也是同样的芯片组:</p> <blockquote><p>参考 <a rel="noopener noreferrer" target="_blank" href="https://docs.broadcom.com/doc/12353227">https://docs.broadcom.com/doc/12353227</a></p></blockquote> <p>所以如果这个用2208的卡可以，那么其他用同样的控制器的卡，理论上有概率也是可以的。</p> <p>所以我们开始试试看把！</p> <h2 id="准备环境">准备环境</h2> <p>配置2208首先要使用DOS环境把卡清空，才可以再刷入2308固件。所以<a rel="noopener noreferrer" target="_blank" href="https://www.freedos.org/download/">FreeDOS</a>走起。</p> <p>如果你有多个U盘的话，可以选择直接下载LITEUSB的镜像写入。这里的问题是因为你还需要把各种工具和固件放进去 --- 虽然你U盘可以很大，但是镜像的文件系统本身为了压缩大小，是限定了分区大小的。也就是如果你没有第二个U盘，你可能还得想想办法扩容分区。我实在是懒得折腾了，Archlinux有个提前分了2G大小压缩后的镜像，但是写入是结结实实要2G。FreeDOS提供的FullUSB镜像在本次过程中分区大小是足够的。</p> <p>主要要准备的东西有：</p> <ol><li>9207_8i_Package_P20_IR_IT_FW_BIOS_for_MSDOS_Windows.zip  (has the 9207-8.bin firmware and mptsas2.rom bios in it)</li> <li>lsi2208fixer.zip (has <code>megarec</code>, <code>megacli</code>, <code>sas2flash</code>, and this has the 2208 recovery firmware)</li> <li>sas2008.zip  (提取 <code>sbrempty.bin</code> file in it)</li> <li>Installer_P20_for_UEFI.zip (this has the version of sas2flash.efi in it for UEFI shell)</li></ol> <p>注意的点：</p> <ol><li>在我测试的过程中，P14和P20的刷写软件都认为9266是兼容的固件。如果你的卡刷不了，可能你要准备P14的固件。我都放在了文章最后的链接里面</li> <li>lsi2208fixer那个镜像里面包含了所有的工具，但是问题就是分区太小了一点。我选择直接复制里面的文件到FullUSB镜像</li></ol> <p>镜像直接dd即可：</p> <div class="saber-highlight" data-lang="bash"><pre class="saber-highlight-code language-bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">dd</span> <span class="token assign-left variable">if</span><span class="token operator">=</span>FD13FULL.img <span class="token assign-left variable">of</span><span class="token operator">=</span>/dev/sda <span class="token assign-left variable">bs</span><span class="token operator">=</span>1M</code></pre></div><p>开个文件夹，正常挂载文件系统即可，不需要额外参数。文件我是开了个文件夹直接放在根目录。</p> <h3 id="freedos指令快速入门">FreeDOS指令快速入门</h3> <div class="saber-highlight" data-lang="bash"><pre class="saber-highlight-code language-bash"><code class="language-bash"><span class="token function">dir</span>
<span class="token builtin class-name">cd</span>
<span class="token function">mkdir</span>
<span class="token builtin class-name">type</span> <span class="token comment"># Same as cat</span>
<span class="token function">more</span> 
<span class="token comment"># &gt; &lt; 这些管道符都是可以正常使用的</span>
<span class="token comment"># 调用程序直接输入名字即可</span>
<span class="token comment"># 可以用tab补全</span>
<span class="token comment"># 有些时候程序名字太长会被缩写，要留意下输出</span></code></pre></div><h3 id="dos16m-error-40-not-enough-available-extended-memory-xmin">dos/16M error: [40] not enough available extended memory (XMIN)</h3> <p>这个问题在我的机器上遇到了，找了一圈看到了这个：</p> <blockquote><p><a rel="noopener noreferrer" target="_blank" href="https://forums.unraid.net/topic/12114-lsi-controller-fw-updates-irit-modes/page/63/">https://forums.unraid.net/topic/12114-lsi-controller-fw-updates-irit-modes/page/63/</a>
Pulling a stick did nothing, that still left me with 4GB in the PC. I couldn't get around this no matter what I tried. I ultimately had to replaced DOS4GW.EXE with <a rel="noopener noreferrer" target="_blank" href="http://dos32a.narechk.net/index_en.html">DOS/32A a more recent DOS Extender</a> which didn't have a problem with what I guess is TOO MUCH ram. I just dumped everything from the extract binw directory into the root of my USB drive and renamed DOS32A.EXE to DOS4GW.EXE and the DOS parts worked.</p></blockquote> <p>拔内存我留4G也没有用，和这个人症状一样。之前在服务器256G都能跑起来，让我很困惑（我换PC的原因是因为服务器重启很慢而且很吵）。但是他里面说道这个Extender确实解决了问题：先<a rel="noopener noreferrer" target="_blank" href="https://dos32a.narechk.net/content/download.html">下载这个extender</a>，然后把里面文件解包全部放到和工具一个目录下，再把<code>DOS32A.EXE</code>改名成<code>DOS4GW.EXE</code>，问题解决。字符串搜索了一下，<code>megarec</code>里面确实提到了这个EXE，有点意思。</p> <h2 id="第一步，清flash">第一步，清Flash</h2> <h3 id="先看看设备在不在">先看看设备在不在</h3> <div class="saber-highlight" data-lang="bash"><pre class="saber-highlight-code language-bash"><code class="language-bash">megarec -adplist</code></pre></div><h3 id="备份一下原本的固件">备份一下原本的固件</h3> <p>备份结果会在当前目录产生</p> <div class="saber-highlight" data-lang="bash"><pre class="saber-highlight-code language-bash"><code class="language-bash">megarec -readsbr <span class="token number">0</span> smc2208.sbr
megarec -readspd <span class="token number">0</span> smc2208.spd
megacli -adpallinfo -a0 <span class="token operator">&gt;</span> allinfo.txt</code></pre></div><p><code>allinfo.txt</code>包含了SAS Address，记得存留</p> <h3 id="刷flash">刷Flash</h3> <div class="saber-highlight" data-lang="bash"><pre class="saber-highlight-code language-bash"><code class="language-bash">megarec -writesbr <span class="token number">0</span> sbrempty.bin
megarec -cleanflash <span class="token number">0</span></code></pre></div><p>如果没有报错，重启后进入下一步</p> <h2 id="cross-flashing">Cross Flashing</h2> <p>在这里我遇到了个奇怪的问题，之前我是用服务器直接刷的，DOS里面<code>SAS2Flash</code>是可以看得到卡，但是换到PC就找不到了，所以我用了<code>sas2flash.efi</code></p> <p>如果你遇到类似的问题，需要进入<code>EFI Shell</code>来处理这个问题，目前的主板一般都会内置一个Shell，所以不需要额外下载EFI执行文件。下面是一些常用的指令：</p> <div class="saber-highlight" data-lang="bash"><pre class="saber-highlight-code language-bash"><code class="language-bash">map <span class="token comment"># 查看所有的映射</span>
<span class="token comment"># efi需要FAT</span>
fs0: <span class="token comment"># 切换到对应的文件系统</span>
<span class="token comment"># 直接看fs开头的找你的U盘</span>
<span class="token builtin class-name">cd</span>
<span class="token comment"># 程序执行直接文件名即可</span></code></pre></div><h3 id="列出设备">列出设备</h3> <div class="saber-highlight" data-lang="bash"><pre class="saber-highlight-code language-bash"><code class="language-bash">sas2flash -list</code></pre></div><h3 id="刷写固件">刷写固件</h3> <div class="saber-highlight" data-lang="bash"><pre class="saber-highlight-code language-bash"><code class="language-bash">sas2flash -o -f <span class="token number">9207</span>-8.bin -b mptsas2.rom</code></pre></div><p>如果你不需要选项，可以忽略<code>-b</code>的rom部分，这样开机就不会进bios，速度快一点。</p> <h4 id="其他选项">其他选项</h4> <p><code>sas2flash</code>其实有很多清理模式：</p> <div class="saber-highlight" data-lang="bash"><pre class="saber-highlight-code language-bash"><code class="language-bash">sas2flsh -o -e <span class="token number">6</span></code></pre></div><p>会清理rom和固件，但是会保留基本信息，例如SASa。<code>7</code>就是清除所有信息</p> <h3 id="写回sasa">写回SASa</h3> <div class="saber-highlight" data-lang="bash"><pre class="saber-highlight-code language-bash"><code class="language-bash">sas2flash -o -sasadd 50030480195exxxx</code></pre></div><h2 id="后续">后续</h2> <p>刷完以后，卡上的蜂鸣器就开始疯狂叫，吵的不行。我不得已先贴了个胶带上去降低音量。原文中评论有人说道一样的卡型号也遇到了类似的问题，虽然卡可以用但是警报是关不掉的。所以他最后选择直接把哪个蜂鸣器取下来。</p> <p>我这里一开始刷完也是可以正常启动的，如果刷了rom甚至是可以看到卡型号和控制器型号正常显示了。但是一旦真正接入了硬盘以后，rom就会在开机的时候卡住。整机报<code>PCI Bus Error</code>。不刷rom可以正常进系统，但是会提示<code>mptsas error</code>。反正横竖认不出来。在当时赶时间，所以直接下单了一块刷好的<code>HP H220</code>先装上发了，但是卡在这个地方丝毫没有头绪。看来这还真的是YMMW？</p> <p>那先试试看能不能恢复固件把，事实证明确实是可以恢复回去的。</p> <h2 id="恢复固件">恢复固件</h2> <div class="saber-highlight" data-lang="bash"><pre class="saber-highlight-code language-bash"><code class="language-bash">megarec -cleanflash <span class="token number">0</span>
<span class="token punctuation">(</span>reboot<span class="token punctuation">)</span>
megarec -writesbr <span class="token number">0</span> smc2208.sbr <span class="token comment"># 之前备份的</span>
megarec -m0flash <span class="token number">0</span> 2208_16.rom  <span class="token comment"># 在恢复工具里面有 (this is the rom from the LSI recovery ROM thread linked above)</span></code></pre></div><h3 id="写回sasa-2">写回SASa</h3> <div class="saber-highlight" data-lang="bash"><pre class="saber-highlight-code language-bash"><code class="language-bash">megaoem -AdpSetSASA 50030480195exxxx -a0</code></pre></div><h2 id="最后的最后">最后的最后</h2> <p>大家记得一定手里要有多几块U盘，来回刷系统测试真的是搞心态。还有就是少碰HBA：）真的兔子洞</p> <h3 id="所有用到的固件工具文件">所有用到的固件/工具文件</h3> <p><a rel="noopener noreferrer" target="_blank" href="https://github.com/HomeofNever/Blog/tree/master/pages/_assets/file/lsi-9266-8i-to-it-mode">https://github.com/HomeofNever/Blog/tree/master/pages/_assets/file/lsi-9266-8i-to-it-mode</a></p> <h3 id="其他相关资料">其他相关资料</h3> <blockquote><p><a rel="noopener noreferrer" target="_blank" href="https://forums.serverbuilds.net/t/flashing-sas2208-to-it-mode-when-sas2flsh-does-not-detect-it/2357">https://forums.serverbuilds.net/t/flashing-sas2208-to-it-mode-when-sas2flsh-does-not-detect-it/2357</a></p></blockquote> <h3 id="用到的资源下载链接">用到的资源下载链接</h3> <blockquote><p><a rel="noopener noreferrer" target="_blank" href="https://forums.laptopvideo2go.com/topic/29059-sas2008-lsi92409211-firmware-files/">https://forums.laptopvideo2go.com/topic/29059-sas2008-lsi92409211-firmware-files/</a></p></blockquote></div> <div class="post-end" data-v-68f7aa60>The end is not the end; Je vous laisse.</div> <section data-v-68f7aa60><div id="disqus_thread"></div></section> <a href="/2022/06/22/lsi-9266-8i-to-it-mode" hidden="hidden" class="u-url router-link-exact-active router-link-active" data-v-68f7aa60></a></article></div></main> <footer class="site-footer h-card"><div class="wrapper"><div class="footer-col-wrapper"><div class="footer-col one-half"><h2 class="footer-heading">Never迷の小窝</h2> <ul class="contact-list"><li class="p-name">NeverBehave</li> <li><a href="mailto:i@never.pet" class="u-email">i@never.pet</a></li></ul></div> <div class="footer-col one-half"><p>迷の生物的迷の小窝</p></div> <div class="social-links"></div></div></div></footer></div></div><script src="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/js/client.e658c2e2.js" defer></script><script src="https://cdn.jsdelivr.net/gh/homeofnever/blog@gh-pages/_saber/js/page--_posts-lsi-9266-8i-to-it-mode-md.b0fc847c.js" defer></script></body></html>
