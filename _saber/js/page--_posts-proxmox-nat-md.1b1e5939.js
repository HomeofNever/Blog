(window.webpackJsonp=window.webpackJsonp||[]).push([[23],{178:function(t,e,o){"use strict";o.r(e);var n=o(0),r=function(t){var e,o,n,r,s=(n=void 0,r="暴露端口",(e={}).type=o="post",e.internal=n,e.contentType="markdown",e.slug="proxmox-nat",e.content=n,e.createdAt=new Date(152902914e4),e.updatedAt=new Date(1655891844544),e.title="Proxmox 开 NAT 小鸡",e.tags=["折腾"],e.categories=["技术"],e.layout=o,e.date="2018-06-15 10:19:00",e.markdownHeadings=[{text:r,slug:r,level:2}],e.excerpt='<p>参考：<a href="https://cyberpersons.com/2016/07/27/setup-nat-proxmox/">https://cyberpersons.com/2016/07/27/setup-nat-proxmox/</a></p>\n',e.permalink="/2018/06/15/proxmox-nat",e.assets={},e.attributes=e,e.tagsInfo=[{name:"折腾",permalink:"/blog/tag/折腾"}],e.categoriesInfo=[{name:"技术",permalink:"/blog/category/technology"}],e),p=t.options.beforeCreate||[];t.options.beforeCreate=[function(){this.$page=s}].concat(p);["layout","transition"].forEach((function(e){var o=t.options.PageComponent;o&&(t.options[e]=o[e]),void 0===t.options[e]&&(t.options[e]=s[e])})),s.slug&&(t.options.name="page-wrapper-"+s.slug.replace(/[^0-9a-z\-]/gi,"-"))},s=Object(n.a)({},(function(){var t=this,e=t.$createElement,o=t._self._c||e;return o("layout-manager",[o("blockquote",[o("p",[t._v("参考："),o("saber-link",{attrs:{to:"https://cyberpersons.com/2016/07/27/setup-nat-proxmox/"}},[t._v("https://cyberpersons.com/2016/07/27/setup-nat-proxmox/")])],1)]),t._v(" "),o("p",[t._v("简而言之就是：")]),t._v(" "),o("ul",[o("li",[t._v("开一个新的bridge（网页上开或者"),o("code",{pre:!0},[t._v("nano /etc/network/interfaces")]),t._v("，但是这种方式似乎proxmox不能绑定"),o("code",{pre:!0},[t._v("Bridge")]),t._v("）")]),t._v(" "),o("li",[t._v("然后iptables转发该网段")]),t._v(" "),o("li",[t._v("还要记得开一下"),o("code",{pre:!0},[t._v("net.ipv4.ip_forward = 1")])])]),t._v(" "),o("p",[o("strong",[t._v("/etc/network/interfaces")]),t._v("\n**记得改"),o("code",{pre:!0},[t._v("-o")]),t._v("后的"),o("code",{pre:!0},[t._v("Bridge")]),t._v("名字")]),t._v(" "),o("div",{pre:!0,attrs:{class:"saber-highlight","data-lang":""}},[o("pre",{pre:!0,attrs:{class:"saber-highlight-code language-text"}},[o("code",{pre:!0,attrs:{class:"language-text"}},[t._v("auto vmbr2\n#private sub network\niface vmbr2 inet static\n        address  192.168.1.1\n        netmask  255.255.255.0\n        bridge_ports none\n        bridge_stp off\n        bridge_fd 0\n\n        post-up echo 1 &gt; /proc/sys/net/ipv4/ip_forward\n        post-up   iptables -t nat -A POSTROUTING -s '192.168.1.0/24' -o vmbr1 -j MASQUERADE\n        post-down iptables -t nat -D POSTROUTING -s '192.168.1.0/24' -o vmbr1 -j MASQUERADE")])])]),o("p",[t._v("但是不建议按照上述内容中第一行"),o("code",{pre:!0},[t._v("post-up")]),t._v("步骤如下：")]),t._v(" "),o("ul",[o("li",[o("code",{pre:!0},[t._v("nano /etc/sysctl.conf")])]),t._v(" "),o("li",[t._v("改 "),o("code",{pre:!0},[t._v("net.ipv4.ip_forward = 1")])]),t._v(" "),o("li",[o("code",{pre:!0},[t._v("sudo sysctl -p")])])]),t._v(" "),o("p",[t._v("效果是一样的，但是会持久化并方便查阅")]),t._v(" "),o("blockquote",[o("p",[t._v("参考："),o("saber-link",{attrs:{to:"https://askubuntu.com/questions/783017/bash-proc-sys-net-ipv4-ip-forward-permission-denied"}},[t._v("https://askubuntu.com/questions/783017/bash-proc-sys-net-ipv4-ip-forward-permission-denied")])],1)]),t._v(" "),o("h2",{attrs:{id:"暴露端口"}},[t._v("暴露端口")]),t._v(" "),o("p",[t._v("例子：")]),t._v(" "),o("p",[o("code",{pre:!0},[t._v("iptables -t nat -A PREROUTING -i vmbr1 -p tcp --dport 3033 -j DNAT --to 192.168.1.2:22 ")])])])}),[],!1,null,null,null);"function"==typeof r&&r(s);e.default=s.exports}}]);