(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{171:function(e,t,a){"use strict";a.r(t);var o=a(0),r=function(e){var t,a,o,r,v=(o=void 0,r="剧情前提",(t={}).type=a="post",t.internal=o,t.contentType="markdown",t.slug="telegram-web-hosting",t.content=o,t.createdAt=new Date(15519822e5),t.updatedAt=new Date(1609740264696),t.title="Telegram Web 搭建",t.tags=["折腾"],t.categories=["技术"],t.layout=a,t.date="2019-03-08 02:10:00",t.markdownHeadings=[{text:r,slug:r,level:1},{text:"Howto",slug:"howto",level:1},{text:"API",slug:"api",level:2},{text:"语言",slug:"语言",level:2},{text:"CI",slug:"ci",level:2}],t.excerpt='<p><a href="https://telegram.org">Telegram</a> 是个好东西，他有个<a href="https://web.telegram.org">Web客户端</a>，也是个好东西</p>\n',t.permalink="/2019/03/08/telegram-web-hosting",t.assets={},t.attributes=t,t.tagsInfo=[{name:"折腾",permalink:"/blog/tag/折腾"}],t.categoriesInfo=[{name:"技术",permalink:"/blog/category/technology"}],t),s=e.options.beforeCreate||[];e.options.beforeCreate=[function(){this.$page=v}].concat(s);["layout","transition"].forEach((function(t){var a=e.options.PageComponent;a&&(e.options[t]=a[t]),void 0===e.options[t]&&(e.options[t]=v[t])})),v.slug&&(e.options.name="page-wrapper-"+v.slug.replace(/[^0-9a-z\-]/gi,"-"))},v=Object(o.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("layout-manager",[a("h1",{attrs:{id:"剧情前提"}},[e._v("剧情前提")]),e._v(" "),a("p",[a("saber-link",{attrs:{to:"https://telegram.org"}},[e._v("Telegram")]),e._v(" 是个好东西，他有个"),a("saber-link",{attrs:{to:"https://web.telegram.org"}},[e._v("Web客户端")]),e._v("，也是个好东西")],1),e._v(" "),a("blockquote",[a("p",[e._v("官方网页源代码："),a("saber-link",{attrs:{to:"https://github.com/zhukov/webogram"}},[e._v("https://github.com/zhukov/webogram")])],1)]),e._v(" "),a("p",[e._v("然而，想要做这个东西的镜像，却没有那么简单")]),e._v(" "),a("h1",{attrs:{id:"howto"}},[e._v("Howto")]),e._v(" "),a("p",[e._v("首先，我要说一句：你的APPID和Hash已经是不可避免的暴露了。毕竟是要在客户端里面给到的")]),e._v(" "),a("p",[e._v("比如说，"),a("saber-link",{attrs:{to:"https://web.telegram.org/js/app.js"}},[e._v("官方客户端的ID")])],1),e._v(" "),a("div",{pre:!0,attrs:{class:"saber-highlight","data-lang":""}},[a("pre",{pre:!0,attrs:{class:"saber-highlight-code language-text"}},[a("code",{pre:!0,attrs:{class:"language-text"}},[e._v("id:2496\nhash:8da85b0d5bfe62527e5b244c209159c3")])])]),a("p",[e._v("本文用到的仓库地址："),a("saber-link",{attrs:{to:"https://gitlab.com/DogeTeam/webogram-new"}},[e._v("https://gitlab.com/DogeTeam/webogram-new")]),e._v("\n你可以通过查阅日志了解每一步的更改")],1),e._v(" "),a("h2",{attrs:{id:"api"}},[e._v("API")]),e._v(" "),a("p",[e._v("Telegram的登陆设计很奇怪（狗屎）：他有5个数据中心，分别对应的Web接口是：")]),e._v(" "),a("ul",[a("li",[e._v("pluto")]),e._v(" "),a("li",[e._v("venus")]),e._v(" "),a("li",[e._v("vesta")]),e._v(" "),a("li",[e._v("aurora")]),e._v(" "),a("li",[e._v("flora")])]),e._v(" "),a("p",[e._v("格式：\n"),a("code",{pre:!0},[e._v("https://' + subdomain + '.web.telegram.org/")])]),e._v(" "),a("p",[e._v("在你填写手机号以后，应用需要"),a("strong",[e._v("一个一个请求这五个中心")]),e._v("才能知道哪个中心是你的账号所在的位置。")]),e._v(" "),a("p",[e._v("所以，也就是说，你需要10个子域名（每个名字还有一个"),a("code",{pre:!0},[e._v("subdomain-1")]),e._v("的（备用？）域名）")]),e._v(" "),a("p",[e._v("我比较懒，懒得搞wildcard（因为用来做代理的机器是临时小鸡，不想放DNS Key上去），就直接用了Caddy")]),e._v(" "),a("p",[a("strong",[e._v("注意")]),e._v("：最近官方似乎反代理，所以"),a("code",{pre:!0},[e._v("Host")]),e._v("头在转发的时候记得给官方的")]),e._v(" "),a("blockquote",[a("p",[a("saber-link",{attrs:{to:"https://gitlab.com/DogeTeam/webogram-new/snippets/1833207"}},[e._v("Caddyfile")]),e._v(" 例子")],1)]),e._v(" "),a("h2",{attrs:{id:"语言"}},[e._v("语言")]),e._v(" "),a("p",[e._v("目前客户端还没有合并中文进去，这有点不能忍啊……")]),e._v(" "),a("p",[e._v("由于客户端是用Angular2开发的，语言文件需要在几个地方注册。具体步骤可以看"),a("saber-link",{attrs:{to:"https://github.com/zhukov/webogram/tree/master/app/js/locales"}},[e._v("这里")])],1),e._v(" "),a("p",[e._v("文章开头提供的仓库内置了中文汉化并设置为了默认，当然还是会检测浏览器的语言")]),e._v(" "),a("p",[a("strong",[e._v("注意")]),e._v("：你最后还需要更改"),a("code",{pre:!0},[e._v("package.json")]),e._v("让你的语言生效，这一步似乎没有在官方的说明里出现")]),e._v(" "),a("p",[e._v("（当时我调了老半天就是没有用，全局搜索语言"),a("code",{pre:!0},[e._v("en-us")]),e._v("偶然发现"),a("code",{pre:!0},[e._v("package.json")]),e._v("里面还要设置emmmm）")]),e._v(" "),a("h2",{attrs:{id:"ci"}},[e._v("CI")]),e._v(" "),a("p",[e._v("每次都要重新打包，懒，自从有了CI以后日子变得好多了（gitlab真香，还可以直接上传到pages）")]),e._v(" "),a("p",[a("strong",[e._v("注意")]),e._v("：gitlab pages 如果通过CI上传，最后生成的build文件夹必须命名是"),a("code",{pre:!0},[e._v("public")]),e._v("，否则失败。（这莫名其妙的错误折腾了好久，因为是"),a("code",{pre:!0},[e._v("External Service")]),e._v("还没有错误提示……）")])])}),[],!1,null,null,null);"function"==typeof r&&r(v);t.default=v.exports}}]);